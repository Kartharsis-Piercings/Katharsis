{% extends 'base.html' %}

{% block title %}Guía de Piercings | Katharsis{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='piercings.css') }}">
{% endblock %}


{% block content %}
    <section class="hero" style=>
        <div class="hero-content">
            <h1>Guía de Piercings</h1>
            <p>Todo lo que necesitas saber para tu próxima perforación</p>
        </div>
    </section>

    <div class="piercing-guide-container">
        <aside class="piercing-nav">
            <button id="nav-toggle-btn" class="nav-toggle-btn">
                <i class="fas fa-bars"></i>
                Navegación
            </button>
            
            <h3>Navegación</h3>
            <ul id="guide-nav-list">
                {% for guide in piercings_data.guides %}
                    <li><a href="#{{ guide.id }}">{{ guide.title }}</a></li>
                {% endfor %}
            </ul>
        </aside>

        <main class="piercing-content">
            {% for guide in piercings_data.guides %}
                <section id="{{ guide.id }}" class="content-section">
                    
                    {% if guide.type == 'zone' %}
                        <h2>{{ guide.title }}</h2>
                        <p class="zone-description">{{ guide.zone_description }}</p>
                        {% if guide.images %}
                            <div class="guide-main-image">
                                <img src="{{ url_for('static', filename=guide.images[0].replace('/static/', '')) }}" alt="{{ guide.title }}">
                            </div>
                        {% endif %}
                        
                        {% for piercing in guide.piercings %}
                            <article class="piercing-article">
                                <h3>{{ piercing.name }}</h3>
                                <div class="piercing-main-content">
                                    <div class="piercing-info-text">
                                        <ul class="piercing-details-list">
                                            <li><strong><i class="fas fa-bolt"></i> Nivel de Dolor:</strong> {{ piercing.details.pain_level }}</li>
                                            <li><strong><i class="far fa-clock"></i> Cicatrización:</strong> {{ piercing.details.healing_time }}</li>
                                            <li><strong><i class="fas fa-gem"></i> Joyería Inicial:</strong> {{ piercing.details.initial_jewelry }}</li>
                                        </ul>
                                        <p>{{ piercing.description }}</p>
                                    </div>
                                    {% if piercing.images %}
                                    <div class="piercing-images">
                                        {% for image in piercing.images %}
                                            <img src="{{ url_for('static', filename=image.replace('/static/', '')) }}" alt="Ejemplo de {{ piercing.name }}">
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>

                                <h4><i class="fas fa-medkit"></i> Consejos de Cuidado</h4>
                                <ul class="aftercare-list">
                                    {% for tip in piercing.aftercare_tips %}
                                        <li>{{ tip }}</li>
                                    {% endfor %}
                                </ul>

                                {% if piercing.recommended_products %}
                                    <h4><i class="fas fa-star"></i> Joyas Recomendadas</h4>
                                    <div class="related-products-grid">
                                        {% for product in piercing.recommended_products %}
                                            {% include 'product_card.html' %}
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </article>
                        {% endfor %}

                    {% elif guide.type == 'info' %}
                        <article class="piercing-article">
                            <h3>{{ guide.title }}</h3>
                            
                            <div class="info-content-constructor">
                                {% for block in guide.content_blocks %}
                                    {# Usamos una clase CSS dinámica basada en el tipo de bloque #}
                                    <div class="info-block block-{{ block.type }}">
                                        
                                        {# Condición para mostrar la imagen (si el bloque la tiene) #}
                                        {% if 'image' in block.type %}
                                        <div class="info-block-image">
                                            <img src="{{ url_for('static', filename=block.image.lstrip('/')) }}" alt="{{ guide.title }}">
                                        </div>
                                        {% endif %}

                                        {# Condición para mostrar el texto (si el bloque lo tiene) #}
                                        {% if 'text' in block.type or block.type in ['image_left', 'image_right'] %}
                                        <div class="info-block-text">
                                            {{ block.text | format_text | safe }}
                                        </div>
                                        {% endif %}

                                    </div>
                                {% endfor %}
                            </div>
                        </article>
                    {% endif %}

                </section>
            {% endfor %}
        </main>
    </div>

    <div class="quick-view-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="modal-product"></div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='product_card.js') }}"></script>
    <script src="{{ url_for('static', filename='catalog.js') }}"></script>
    {# ¡Añadiremos un nuevo archivo JS para esta página! #}
    <script src="{{ url_for('static', filename='piercings.js') }}"></script>
{% endblock %}