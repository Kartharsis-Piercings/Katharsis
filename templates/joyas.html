{% extends 'base.html' %}

{% block title %}Joyas | Katharsis{% endblock %}


{% block content %}
    <section class="hero-joyas">
        <div class="hero-content-joyas">
            <h1>Nuestra Colección de Joyas</h1>
            <p>Titanio grado implante - Seguridad y estilo en cada pieza</p>
        </div>
    </section>

    <div class="catalog-container">
        <!-- Filtros y controles -->
        <aside class="catalog-filters">
            <div class="filter-section">
                <h3>Categorías</h3>
                <ul class="filter-list">
                    <li>
                        <a href="{{ url_for('joyas', category='all', body_part='all', material=current_filters.material, max_price=current_filters.max_price, sort_by=current_filters.sort_by) }}"
                        class="{% if current_filters.category == 'all' %}filter-active{% endif %}">
                            Todos
                        </a>
                    </li>
                    {% for cat in categories %}
                    <li>
                        <a href="{{ url_for('joyas', category=cat.id, body_part='all', material=current_filters.material, max_price=current_filters.max_price, sort_by=current_filters.sort_by) }}"
                        class="{% if current_filters.category == cat.id|string %}filter-active{% endif %}">
                            {{ cat.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="filter-section">
                <h3>Zona del cuerpo</h3>
                <ul class="filter-list">
                    <li>
                        <a href="{{ url_for('joyas', body_part='all', category='all', material=current_filters.material, max_price=current_filters.max_price, sort_by=current_filters.sort_by) }}"
                        class="{% if current_filters.body_part == 'all' %}filter-active{% endif %}">
                            Todos
                        </a>
                    </li>
                    {% for part in body_parts %}
                    <li>
                        <a href="{{ url_for('joyas', body_part=part.id, category='all', material=current_filters.material, max_price=current_filters.max_price, sort_by=current_filters.sort_by) }}"
                        class="{% if current_filters.body_part == part.id %}filter-active{% endif %}">
                            {{ part.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>

            <div class="filter-section">
                <h3>Material</h3>
                <ul class="filter-list">
                    <li>
                        <a href="{{ url_for('joyas', material='all', category=current_filters.category, body_part=current_filters.body_part, max_price=current_filters.max_price, sort_by=current_filters.sort_by) }}"
                        class="{% if current_filters.material == 'all' %}filter-active{% endif %}">
                            Todos
                        </a>
                    </li>
                    {% for mat in materials %}
                    <li>
                        <a href="{{ url_for('joyas', material=mat.id, category=current_filters.category, body_part=current_filters.body_part, max_price=current_filters.max_price, sort_by=current_filters.sort_by) }}"
                        class="{% if current_filters.material == mat.id %}filter-active{% endif %}">
                            {{ mat.name }}
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            
            <div class="filter-section">
                <h3>Precio</h3>
                <form method="GET" action="{{ url_for('joyas') }}" id="price-filter-form">
                    <input type="hidden" name="category" value="{{ current_filters.category }}">
                    <input type="hidden" name="body_part" value="{{ current_filters.body_part }}">
                    <input type="hidden" name="material" value="{{ current_filters.material }}">
                    <input type="hidden" name="sort_by" value="{{ current_filters.sort_by }}">
                    
                    <div class="price-range">
                        <input type="range" min="0" max="300" step="10" value="{{ current_filters.max_price }}" class="price-slider"
                            name="max_price" id="price-slider">
                        <div class="price-values">
                            <span>S/ 0</span>
                            <span>S/ <span id="max-price-display">{{ current_filters.max_price | number_format }}</span></span>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn-apply-filters">Aplicar Filtros</button>
                </form>
            </div>
            
            <a href="{{ url_for('joyas') }}" class="btn-clear-filters">Limpiar Filtros</a>
        </aside>
        
        <!-- Productos -->
        <main class="catalog-products">
            <div class="mobile-filter-header">
                <button id="filter-toggle-btn" class="btn btn-secondary">
                    <i class="fas fa-filter"></i> Ver Filtros
                </button>
            </div>
            <div class="catalog-controls">
                <div class="sort-options">
                    <span>Ordenar por:</span>
                    <select id="sort-select">
                        <option value="popular" {% if sort_by == 'popular' %}selected{% endif %}>Más populares</option>
                        <option value="price_asc" {% if sort_by == 'price_asc' %}selected{% endif %}>Precio: menor a mayor</option>
                        <option value="price_desc" {% if sort_by == 'price_desc' %}selected{% endif %}>Precio: mayor a menor</option>
                        <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>Más nuevos</option>
                    </select>
                </div>
                
                <div class="view-options">
                    <button class="view-btn grid-view active"><i class="fas fa-th"></i></button>
                    <button class="view-btn list-view"><i class="fas fa-list"></i></button>
                </div>
            </div>
            
            <div class="products-grid">
                {% if products %}
                    {% for product in products %} {# o related_products #}
                        {% include 'product_card.html' %}
                    {% endfor %}
                {% else %}
                <div class="no-products">
                    <p>No se encontraron productos con los filtros seleccionados.</p>
                    <a href="{{ url_for('joyas') }}" class="btn-clear">Ver todos los productos</a>
                </div>
                {% endif %}
            </div>
            
            <div id="pagination-container" 
            class="pagination"
            data-total-pages="{{ total_pages }}"
            data-current-page="{{ page }}">
            </div>
            
        </main>
    </div>

    <!-- Modal Vista Rápida -->
    <div class="quick-view-modal">
        <div class="modal-content">
            <button class="close-modal">&times;</button>
            <div class="modal-product">
                <!-- Contenido dinámico será insertado por JavaScript -->
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
<script>
// Función para validar selección de tamaño
function validateSize(form) {
    const sizeSelect = form.querySelector('select[name="size"]');
    if (!sizeSelect.value) {
        alert("Por favor selecciona un tamaño");
        return false;
    }
    return true;
}

// Asignar la validación a todos los formularios
document.querySelectorAll('.add-to-cart-form').forEach(form => {
    form.onsubmit = function() {
        return validateSize(this);
    };
});
</script>
<script src="{{ url_for('static', filename='catalog.js') }}"></script>
{% endblock %}

